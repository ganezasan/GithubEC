var Cart=function(){this.items=[],this.amount=0,this.addItem=function(t){this.items.push(t),this.amount+=t.amount},this.cancelItem=function(t){this.items=this.items.filter(function(n){return n.number!==t.number}),this.amount-=t.amount},this.checkItem=function(t){return this.items.filter(function(n){return n.number===t.number}).length>0}};
function init(){marked.setOptions({renderer:new marked.Renderer,gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),this.modal=$("[data-remodal-id=modal]").remodal(),d3.json("https://api.github.com/repos/ganezasan/dump/issues?state=all&per_page=100",function(t,e){this.openIssues=e.filter(function(t){return"open"===t.state&&void 0===t.pull_request}),this.closedIssues=e.filter(function(t){return"closed"===t.state&&void 0===t.pull_request}),initTable(this.openIssues,"#SaleItems"),initTable(this.closedIssues,"#SoldItems"),initTable(this.cart.items,"#CartItems")}),this.cart=new Cart,updateTotal(),$("#tabs li").on("click",function(t){$('#tabs li[class="active"]').removeClass("active"),$(this).attr("class","active"),$(".main table").css("display","none"),$('.main[data-type="'+$(this).attr("data-type")+'"] table').css("display","block")}),$("#purchase").on("click",function(){openModal("success","PullRequestを送ってください。",!0)})}function updateTotal(){var t=d3.select("#totalAmount").selectAll("a").data([this.cart]);t.enter().append("a").text(function(t){return"total: "+t.amount}),t.text(function(t){return"total: ¥"+t.amount})}function addCart(t){if(this.cart.checkItem(t))return openModal("danger","既にカートに入っています",!1),!1;t.amount=getAmount(t.body),this.cart.addItem(t),updateTotal(),initTable(this.cart.items,"#CartItems");var e=t.title+"をカートに追加しました。";openModal("success",e,!1)}function cancelItem(t){t.amount=getAmount(t.body),this.cart.cancelItem(t),updateTotal(),updateTable(this.cart.items,"#CartItems");var e=t.title+"をカートから削除しました。";openModal("success",e,!1)}function getAmount(t){var e=t.match(/[\d,]?[\d,]+(\r){1}/);return e.length>0?Number(e[0].split(",").join("")):0}function initTable(t,e){var a=d3.select(e).select("tbody"),s=a.selectAll("tr").data(t);if(td=s.enter().append("tr").append("td"),s.exit().remove(),td.append("h2").text(function(t){return"#"+t.number+" : "+t.title}),td.append("text").attr("class","detail").attr("dy",".3em").style("text-anchor","middle").html(function(t){return marked(t.body)}),"#SaleItems"===e||"#CartItems"===e)var n=td.append("button").attr("class","btn btn-default");"#SaleItems"===e?n.text("add").on("click",function(t){addCart(t)}):"#CartItems"===e&&n.text("cancel").on("click",function(t){cancelItem(t)}),setImageViewer(e)}function updateTable(t,e){var a=d3.select(e).select("tbody"),s=a.selectAll("tr").data(t);if(s.enter().append("tr").append("td"),s.exit().remove(),td=a.selectAll("td").data(t),td.select("h2").text(function(t){return"#"+t.number+" : "+t.title}),td.select("text").attr("class","detail").attr("dy",".3em").style("text-anchor","middle").html(function(t){return marked(t.body)}),"#SaleItems"===e||"#CartItems"===e)var n=td.select("button").attr("class","btn btn-default");"#SaleItems"===e?n.text("add").on("click",function(t){addCart(t)}):"#CartItems"===e&&n.text("cancel").on("click",function(t){cancelItem(t)}),setImageViewer(e)}function setImageViewer(t){$(t+" tr").each(function(t,e){var a=$(e).find(".detail").find("img").get();if(0!==a.length){$(e).find(".images").remove();var s=$("<ul>").attr("class","images");a.forEach(function(t){$(t).attr("class","img-thumbnail"),s.append($("<li>").append(t))}),$(e).children("td").children("h2").after(s)}}),$(".images").viewer()}function openModal(t,e,a){if($("[data-remodal-id=modal] .message").text(e),"success"===t?$("[data-remodal-id=modal] .title").removeClass("alert-danger").addClass("alert-success").text("Thank You"):$("[data-remodal-id=modal] .title").removeClass("alert-success").addClass("alert-danger").text("Alart"),a){var s="git commit --allow-empty -m ",n="";this.cart.items.forEach(function(t){n+="close #"+t.number+" "}),s+='"'+n+'"',$("#OrderMessage").text(s),$("[data-remodal-id=modal] .markdown-body").css("display","block")}else $("[data-remodal-id=modal] .markdown-body").css("display","none");this.modal.open()}init();